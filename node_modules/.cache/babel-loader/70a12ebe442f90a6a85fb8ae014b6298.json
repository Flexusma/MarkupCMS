{"remainingRequest":"B:\\Gitkraken\\MarkupCMS\\node_modules\\thread-loader\\dist\\cjs.js!B:\\Gitkraken\\MarkupCMS\\node_modules\\babel-loader\\lib\\index.js!B:\\Gitkraken\\MarkupCMS\\node_modules\\eslint-loader\\index.js??ref--13-0!B:\\Gitkraken\\MarkupCMS\\src\\auth\\authService.js","dependencies":[{"path":"B:\\Gitkraken\\MarkupCMS\\src\\auth\\authService.js","mtime":1610463876125},{"path":"B:\\Gitkraken\\MarkupCMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"B:\\Gitkraken\\MarkupCMS\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"B:\\Gitkraken\\MarkupCMS\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"B:\\Gitkraken\\MarkupCMS\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIjsKaW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkI6L0dpdGtyYWtlbi9NYXJrdXBDTVMvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIkI6L0dpdGtyYWtlbi9NYXJrdXBDTVMvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJCOi9HaXRrcmFrZW4vTWFya3VwQ01TL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiQjovR2l0a3Jha2VuL01hcmt1cENNUy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vZGVmaW5lUHJvcGVydHkiOwppbXBvcnQgeyBhcGksIGNvbnN0YW50LCBlcnJvcl9tc2csIHZ1ZSwgYXBwIH0gZnJvbSAiQC9tYWluIjsKaW1wb3J0IHsgTmV4dEVycm9yUmVkaXIgfSBmcm9tICJAL3JvdXRlci9yb3V0ZXJfdXRpbHMiOwppbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnOwoKdmFyIEF1dGhTZXJ2aWNlID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBBdXRoU2VydmljZSgpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBBdXRoU2VydmljZSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJ1c2VyIiwgdW5kZWZpbmVkKTsKICB9CgogIF9jcmVhdGVDbGFzcyhBdXRoU2VydmljZSwgW3sKICAgIGtleTogImlzQXV0aGVudGljYXRlZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaXNBdXRoZW50aWNhdGVkKCkgewogICAgICBpZiAodGhpcy5nZXRBdXRoKCkgPT09IHVuZGVmaW5lZCkgdGhpcy5jaGVja0F1dGhSZXEoKTsKICAgICAgcmV0dXJuIHRoaXMuZ2V0QXV0aCgpOwogICAgfQogIH0sIHsKICAgIGtleTogImxvZ2luUmVkaXJlY3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGxvZ2luUmVkaXJlY3QoKSB7CiAgICAgIHRoaXMuY2hlY2tBdXRoUmVxKCk7CiAgICAgIHRoaXMucHVzaCgibG9naW4iKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJsb2dvdXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGxvZ291dChvYmopIHsKICAgICAgdmFyIGxvZ291dCA9IGF4aW9zKHsKICAgICAgICBtZXRob2Q6ICdkZWxldGUnLAogICAgICAgIHVybDogYXBpLmFwaV9iYXNlX3VybCArIGFwaS5hcGlfc2Vzc2lvbl9wYXRoCiAgICAgIH0pOwogICAgICBBdXRoU2VydmljZUluc3RhbmNlLnNldEF1dGgoZmFsc2UpOwogICAgICB0aGlzLmF1dGhBeGlvc05vUmVkKGxvZ291dCkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgaWYgKGNvbnN0YW50LmRlYnVnKSBjb25zb2xlLmxvZyhyZXMpOwoKICAgICAgICBpZiAocmVzLmRhdGEuaW5mby5jb2RlID09PSAyMDApIHsKICAgICAgICAgIGlmIChvYmogIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAvL2lmIChvYmoucmV0dXJuVG8gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAvLyAgICB2dWUuJHJvdXRlci5wdXNoKG9iai5yZXR1cm5Ubyk7CiAgICAgICAgICAgIC8vfSBlbHNlIHsKICAgICAgICAgICAgYXBwLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgQXV0aFNlcnZpY2VJbnN0YW5jZS5zZXRBdXRoKGZhbHNlKTsKICAgICAgICAgICAgICBBdXRoU2VydmljZUluc3RhbmNlLnB1c2goY29uc3RhbnQuaG9tZV9wYWdlX25hbWUpOwogICAgICAgICAgICAgIGFwcC4kcm9vdC4kcm91dGVyLmdvKDApOwogICAgICAgICAgICAgIGFwcC4kcm9vdC4kcm91dGVyLmdvKDApOwogICAgICAgICAgICB9KTsgLy8gfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMuY2hlY2tBdXRoUmVxKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAicm91dGVBdXRoQ2hlY2siLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9yb3V0ZUF1dGhDaGVjayA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShuZXh0KSB7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgdGhpcy5jaGVja0F1dGhSZXEoKTsKCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0F1dGhlbnRpY2F0ZWQoKSkgewogICAgICAgICAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvL2p1c3QgaW4gY2FzZSBBdXRoQXhpb3MgZmFpbHMKICAgICAgICAgICAgICAgICAgICBuZXh0KHsKICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJsb2dpbiIKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICBpZiAoY29uc3RhbnQuZGVidWcpIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgICAgICAgICBOZXh0RXJyb3JSZWRpcihlcnJvcl9tc2cuY291bGRfbm90X3ZlcmlmeV9sb2dpbi5jb2RlLCBlcnJvcl9tc2cuY291bGRfbm90X3ZlcmlmeV9sb2dpbi5tZXNzYWdlLCBuZXh0KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHJvdXRlQXV0aENoZWNrKF94KSB7CiAgICAgICAgcmV0dXJuIF9yb3V0ZUF1dGhDaGVjay5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gcm91dGVBdXRoQ2hlY2s7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJhdXRoQXhpb3MiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9hdXRoQXhpb3MgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKGF4aW8sIG5leHQpIHsKICAgICAgICB2YXIgcmVzcDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgdGhpcy5jaGVja0F1dGhSZXEoKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiBheGlvOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICByZXNwID0gX2NvbnRleHQyLnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKCEocmVzcC5kYXRhLmluZm8uY29kZSA9PT0gNjAxKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoIShuZXh0ICE9PSB1bmRlZmluZWQpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG5leHQoewogICAgICAgICAgICAgICAgICBuYW1lOiAibG9naW4iCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBmYWxzZSk7CgogICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICB2dWUuJHJvdXRlci5wdXNoKCJsb2dpbiIpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIGZhbHNlKTsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCByZXNwKTsKCiAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMiwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGF1dGhBeGlvcyhfeDIsIF94MykgewogICAgICAgIHJldHVybiBfYXV0aEF4aW9zLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBhdXRoQXhpb3M7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJhdXRoQXhpb3NOb1JlZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2F1dGhBeGlvc05vUmVkID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMyhheGlvKSB7CiAgICAgICAgdmFyIHJlc3A7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tBdXRoUmVxKCk7CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gYXhpbzsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgcmVzcCA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHJlc3ApOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTMsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBhdXRoQXhpb3NOb1JlZChfeDQpIHsKICAgICAgICByZXR1cm4gX2F1dGhBeGlvc05vUmVkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBhdXRoQXhpb3NOb1JlZDsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImxvZ2luV2l0aENyZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9sb2dpbldpdGhDcmVkID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNCh1c2VyLCBwYXNzKSB7CiAgICAgICAgdmFyIHJlc3A7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiBheGlvcy5wb3N0KGFwaS5hcGlfYmFzZV91cmwgKyBhcGkuYXBpX3Nlc3Npb25fcGF0aCwgIiIsIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgICd4LXVzZXInOiB1c2VyLAogICAgICAgICAgICAgICAgICAgICd4LXBhc3MnOiBwYXNzCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICByZXNwID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICBpZiAoY29uc3RhbnQuZGVidWcpIGNvbnNvbGUubG9nKHJlc3ApOwoKICAgICAgICAgICAgICAgIGlmICghKHJlc3AuZGF0YS5pbmZvLmNvZGUgPT09IDIwMCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy51c2VyID0gcmVzcC5kYXRhLmRhdGFbMF07CiAgICAgICAgICAgICAgICBpZiAoY29uc3RhbnQuZGVidWcpIGNvbnNvbGUubG9nKHJlc3AuZGF0YS5kYXRhKTsKICAgICAgICAgICAgICAgIHRoaXMuc2V0QXV0aCh0cnVlKTsKICAgICAgICAgICAgICAgIGlmIChjb25zdGFudC5kZWJ1ZykgY29uc29sZS5sb2coInNldHRpbmcgYXV0aCB0byB0cnVlIik7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgcmVzcC5kYXRhKTsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCByZXNwLmRhdGEpOwoKICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU0LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gbG9naW5XaXRoQ3JlZChfeDUsIF94NikgewogICAgICAgIHJldHVybiBfbG9naW5XaXRoQ3JlZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gbG9naW5XaXRoQ3JlZDsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImNoZWNrQXV0aFJlcSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2hlY2tBdXRoUmVxKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgYXhpb3MuZ2V0KGFwaS5hcGlfYmFzZV91cmwgKyBhcGkuYXBpX3Nlc3Npb25fY2hlY2tfcGF0aCkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMuY2hlY2tBdXRoKHJlcyk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImNoZWNrQXV0aFJlcUFzeW5jIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfY2hlY2tBdXRoUmVxQXN5bmMgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1KCkgewogICAgICAgIHZhciByZXM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiBheGlvcy5nZXQoYXBpLmFwaV9iYXNlX3VybCArIGFwaS5hcGlfc2Vzc2lvbl9jaGVja19wYXRoKTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgcmVzID0gX2NvbnRleHQ1LnNlbnQ7CiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrQXV0aChyZXMpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBjaGVja0F1dGhSZXFBc3luYygpIHsKICAgICAgICByZXR1cm4gX2NoZWNrQXV0aFJlcUFzeW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBjaGVja0F1dGhSZXFBc3luYzsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImlzQXV0aFVzZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9pc0F1dGhVc2VyID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNigpIHsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTYkKF9jb250ZXh0NikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDYucHJldiA9IF9jb250ZXh0Ni5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tBdXRoUmVxQXN5bmMoKTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgaXNBdXRoOiB0aGlzLmdldEF1dGgoKSwKICAgICAgICAgICAgICAgICAgdXNlcjogdGhpcy51c2VyCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU2LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gaXNBdXRoVXNlcigpIHsKICAgICAgICByZXR1cm4gX2lzQXV0aFVzZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGlzQXV0aFVzZXI7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJjaGVja0F1dGgiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNoZWNrQXV0aChyZXMpIHsKICAgICAgaWYgKGNvbnN0YW50LmRlYnVnKSBjb25zb2xlLmxvZygiQ2hlY2tpbmcgdXNlciBhdXRoLiBHb3QgcmVzcG9uc2U6ICIsIHJlcy5kYXRhKTsKCiAgICAgIGlmIChyZXMuZGF0YS5pbmZvLmNvZGUgPT09IDIwMCkgewogICAgICAgIGlmIChjb25zdGFudC5kZWJ1ZykgY29uc29sZS5sb2coIkF1dGg6IHRydWUiKTsKICAgICAgICB0aGlzLnNldEF1dGgodHJ1ZSk7CiAgICAgICAgdGhpcy51c2VyID0gcmVzLmRhdGEuZGF0YTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoY29uc3RhbnQuZGVidWcpIGNvbnNvbGUubG9nKCJBdXRoOiBmYWxzZSIpOwogICAgICAgIHRoaXMuc2V0QXV0aChmYWxzZSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJwdXNoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwdXNoKHRvKSB7CiAgICAgIGlmIChjb25zdGFudC5kZWJ1ZykgY29uc29sZS5sb2coYXBwKTsKCiAgICAgIGlmIChhcHAuJHJvdXRlLm5hbWUgIT09IHRvKSB7CiAgICAgICAgYXBwLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICBuYW1lOiB0bwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0QXV0aCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0QXV0aCh0KSB7CiAgICAgIGFwcC5pc0F1dGggPSB0OwogICAgfQogIH0sIHsKICAgIGtleTogImdldEF1dGgiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEF1dGgoKSB7CiAgICAgIGlmIChhcHAgIT09IHVuZGVmaW5lZCkgcmV0dXJuIGFwcC5pc0F1dGg7ZWxzZSByZXR1cm4gdW5kZWZpbmVkOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEF1dGhTZXJ2aWNlOwp9KCk7Cgp2YXIgQXV0aFNlcnZpY2VJbnN0YW5jZSA9IG5ldyBBdXRoU2VydmljZSgpOwpleHBvcnQgZGVmYXVsdCBBdXRoU2VydmljZUluc3RhbmNlOwpleHBvcnQgZnVuY3Rpb24gaW5pdEF1dGhTZXJ2aWNlKHZ1ZSkgewogIEF1dGhTZXJ2aWNlSW5zdGFuY2UuY2hlY2tBdXRoUmVxKCk7CiAgdnVlLmNvbmZpZy5nbG9iYWxQcm9wZXJ0aWVzLiRhdXRoID0gQXV0aFNlcnZpY2VJbnN0YW5jZTsKfQ=="},{"version":3,"sources":["B:/Gitkraken/MarkupCMS/src/auth/authService.js"],"names":["api","constant","error_msg","vue","app","NextErrorRedir","axios","AuthService","undefined","getAuth","checkAuthReq","push","obj","logout","method","url","api_base_url","api_session_path","AuthServiceInstance","setAuth","authAxiosNoRed","then","res","debug","console","log","data","info","code","$nextTick","home_page_name","$root","$router","go","next","isAuthenticated","name","e","could_not_verify_login","message","axio","resp","user","pass","post","headers","get","api_session_check_path","checkAuth","checkAuthReqAsync","isAuth","to","$route","t","initAuthService","config","globalProperties","$auth"],"mappings":"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","sourcesContent":["import {api, constant, error_msg, vue, app} from \"@/main\";\r\nimport {NextErrorRedir} from \"@/router/router_utils\";\r\nimport axios from 'axios';\r\n\r\nclass AuthService{\r\n\r\n\r\n    isAuthenticated(){\r\n        if(this.getAuth()===undefined)\r\n            this.checkAuthReq();\r\n        return this.getAuth()\r\n    }\r\n\r\n    user = undefined;\r\n\r\n    loginRedirect(){\r\n        this.checkAuthReq();\r\n        this.push(\"login\");\r\n    }\r\n\r\n    logout(obj){\r\n\r\n        let logout = axios({\r\n            method: 'delete',\r\n            url: api.api_base_url+api.api_session_path,\r\n        })\r\n        AuthServiceInstance.setAuth(false);\r\n        this.authAxiosNoRed(logout).then(function (res){\r\n            if(constant.debug)\r\n            console.log(res)\r\n\r\n            if(res.data.info.code===200) {\r\n                if (obj !== undefined) {\r\n                    //if (obj.returnTo !== undefined) {\r\n                    //    vue.$router.push(obj.returnTo);\r\n                    //} else {\r\n                    app.$nextTick(()=>{\r\n                        AuthServiceInstance.setAuth(false);\r\n                        AuthServiceInstance.push(constant.home_page_name);\r\n                        app.$root.$router.go(0);\r\n                        app.$root.$router.go(0);\r\n                    });\r\n\r\n                   // }\r\n                }\r\n            }\r\n        });\r\n        this.checkAuthReq();\r\n\r\n\r\n    }\r\n\r\n    async routeAuthCheck(next){\r\n        this.checkAuthReq();\r\n        try {\r\n            if(this.isAuthenticated()){\r\n                next();\r\n            } else {\r\n                //just in case AuthAxios fails\r\n                next({name: \"login\"});\r\n            }\r\n        }catch (e){\r\n            if(constant.debug)\r\n            console.log(e);\r\n            NextErrorRedir(error_msg.could_not_verify_login.code,error_msg.could_not_verify_login.message,next);\r\n        }\r\n    }\r\n\r\n    async authAxios(axio,next){\r\n        this.checkAuthReq();\r\n        let resp= await axio;\r\n        if(resp.data.info.code===601){\r\n            if(next!==undefined) {\r\n                next({name: \"login\"});\r\n                return false;\r\n            }else {\r\n                vue.$router.push(\"login\");\r\n                return false;\r\n            }\r\n        } else\r\n            return resp;\r\n    }\r\n\r\n    async authAxiosNoRed(axio){\r\n        this.checkAuthReq();\r\n        let resp = await axio;\r\n        return resp;\r\n    }\r\n\r\n    async loginWithCred(user, pass){\r\n        let resp = await axios.post(api.api_base_url+api.api_session_path,\"\",{headers:{\r\n            'x-user':user,\r\n            'x-pass':pass\r\n        },\r\n        });\r\n        if(constant.debug)\r\n        console.log(resp);\r\n        if(resp.data.info.code===200){\r\n            this.user = resp.data.data[0];\r\n            if(constant.debug)\r\n            console.log(resp.data.data)\r\n            this.setAuth(true);\r\n            if(constant.debug)\r\n            console.log(\"setting auth to true\");\r\n            return resp.data;\r\n        }else return resp.data;\r\n    }\r\n\r\n    checkAuthReq(){\r\n        axios.get(api.api_base_url+api.api_session_check_path).then((res) => {\r\n            this.checkAuth(res);\r\n        })\r\n    }\r\n\r\n    async checkAuthReqAsync(){\r\n        const res = await axios.get(api.api_base_url+api.api_session_check_path);\r\n        this.checkAuth(res);\r\n    }\r\n\r\n    async isAuthUser(){\r\n        await this.checkAuthReqAsync();\r\n        return {\r\n            isAuth: this.getAuth(),\r\n            user: this.user\r\n        };\r\n\r\n    }\r\n\r\n    checkAuth(res){\r\n        if(constant.debug)\r\n        console.log(\"Checking user auth. Got response: \",res.data);\r\n        if(res.data.info.code===200) {\r\n            if(constant.debug)\r\n            console.log(\"Auth: true\")\r\n            this.setAuth(true)\r\n            this.user=res.data.data;\r\n        }\r\n        else{\r\n            if(constant.debug)\r\n            console.log(\"Auth: false\")\r\n            this.setAuth(false)\r\n        }\r\n    }\r\n\r\n\r\n    push(to){\r\n        if(constant.debug)\r\n        console.log(app)\r\n        if(app.$route.name!==to){\r\n            app.$router.push({name: to});\r\n        }\r\n    }\r\n    setAuth(t){\r\n      app.isAuth = t;\r\n    }\r\n    getAuth(){\r\n        if(app!==undefined)\r\n            return app.isAuth;\r\n        else return undefined;\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\nlet AuthServiceInstance = new AuthService();\r\n\r\nexport default AuthServiceInstance;\r\n\r\nexport function initAuthService(vue){\r\n\r\n    AuthServiceInstance.checkAuthReq();\r\n    vue.config.globalProperties.$auth=AuthServiceInstance;\r\n\r\n}"]}]}